<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ç½²çŠ¶æ€æ£€æŸ¥</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            color: #1a202c;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #e2e8f0;
        }
        .status-success {
            background: #f0fff4;
            border-left-color: #38a169;
            color: #2f855a;
        }
        .status-error {
            background: #fff5f5;
            border-left-color: #e53e3e;
            color: #c53030;
        }
        .status-warning {
            background: #fffbeb;
            border-left-color: #d69e2e;
            color: #b7791f;
        }
        .status-loading {
            background: #ebf8ff;
            border-left-color: #3182ce;
            color: #2c5282;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #5a67d8;
        }
        .timestamp {
            font-size: 12px;
            color: #718096;
        }
        .feature-test {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸš€ Clashé…ç½®ç®¡ç†å™¨ - éƒ¨ç½²çŠ¶æ€</h1>
        <p>æ£€æŸ¥GitHub Pageséƒ¨ç½²çŠ¶æ€å’ŒåŠŸèƒ½å¯ç”¨æ€§</p>
        <div class="timestamp">æ£€æŸ¥æ—¶é—´: <span id="checkTime"></span></div>
    </div>

    <div class="status-card">
        <h2>ğŸ“Š éƒ¨ç½²çŠ¶æ€æ£€æŸ¥</h2>
        <div id="deploymentStatus">
            <div class="status-item status-loading">
                <span>ğŸ”„ æ­£åœ¨æ£€æŸ¥éƒ¨ç½²çŠ¶æ€...</span>
            </div>
        </div>
        <button class="btn" onclick="checkDeploymentStatus()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="status-card">
        <h2>ğŸ“ æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥</h2>
        <div id="fileStatus">
            <div class="status-item status-loading">
                <span>ğŸ”„ æ­£åœ¨æ£€æŸ¥æ–‡ä»¶...</span>
            </div>
        </div>
    </div>

    <div class="status-card">
        <h2>âš™ï¸ åŠŸèƒ½æµ‹è¯•</h2>
        <div id="featureStatus">
            <div class="status-item status-loading">
                <span>ğŸ”„ æ­£åœ¨æµ‹è¯•åŠŸèƒ½...</span>
            </div>
        </div>
        <div class="feature-test">
            <h3>URLç”Ÿæˆå™¨æµ‹è¯•</h3>
            <button class="btn" onclick="testUrlGenerator()">æµ‹è¯•URLç”ŸæˆåŠŸèƒ½</button>
            <div id="urlGeneratorTest"></div>
        </div>
    </div>

    <div class="status-card">
        <h2>ğŸ”— å¿«é€Ÿé“¾æ¥</h2>
        <a href="index.html" class="btn">è¿”å›ä¸»é¡µ</a>
        <a href="https://github.com/rdone4425/clash-rule/actions" class="btn" target="_blank">æŸ¥çœ‹GitHub Actions</a>
        <a href="version-check.html" class="btn">ç‰ˆæœ¬æ£€æŸ¥</a>
    </div>

    <script>
        // è®¾ç½®æ£€æŸ¥æ—¶é—´
        document.getElementById('checkTime').textContent = new Date().toLocaleString();

        // éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶åˆ—è¡¨
        const criticalFiles = [
            { path: 'index.html', name: 'ä¸»é¡µé¢' },
            { path: 'js/main.js', name: 'ä¸»åº”ç”¨' },
            { path: 'js/modules/url-generator.js', name: 'URLç”Ÿæˆå™¨' },
            { path: 'js/modules/rule-manager.js', name: 'è§„åˆ™ç®¡ç†å™¨' },
            { path: 'styles/components.css', name: 'æ ·å¼æ–‡ä»¶' }
        ];

        // æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        async function checkDeploymentStatus() {
            const statusDiv = document.getElementById('deploymentStatus');
            statusDiv.innerHTML = '<div class="status-item status-loading"><span>ğŸ”„ æ£€æŸ¥ä¸­...</span></div>';

            try {
                // æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦å¯è®¿é—®
                const response = await fetch('index.html');
                if (response.ok) {
                    const html = await response.text();
                    
                    // æ£€æŸ¥æ˜¯å¦åŒ…å«URLç”ŸæˆæŒ‰é’®
                    if (html.includes('ç”Ÿæˆè®¢é˜…')) {
                        statusDiv.innerHTML = `
                            <div class="status-item status-success">
                                <span>âœ… éƒ¨ç½²æˆåŠŸ - åŒ…å«æœ€æ–°åŠŸèƒ½</span>
                                <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML = `
                            <div class="status-item status-warning">
                                <span>âš ï¸ éƒ¨ç½²æˆåŠŸä½†ç‰ˆæœ¬å¯èƒ½è¾ƒæ—§</span>
                                <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                            </div>
                        `;
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status-item status-error">
                        <span>âŒ éƒ¨ç½²æ£€æŸ¥å¤±è´¥: ${error.message}</span>
                        <span class="timestamp">${new Date().toLocaleTimeString()}</span>
                    </div>
                `;
            }
        }

        // æ£€æŸ¥æ–‡ä»¶çŠ¶æ€
        async function checkFiles() {
            const statusDiv = document.getElementById('fileStatus');
            statusDiv.innerHTML = '<div class="status-item status-loading"><span>ğŸ”„ æ£€æŸ¥æ–‡ä»¶ä¸­...</span></div>';

            const results = [];
            
            for (const file of criticalFiles) {
                try {
                    const response = await fetch(file.path);
                    if (response.ok) {
                        results.push(`
                            <div class="status-item status-success">
                                <span>âœ… ${file.name}</span>
                                <span>${file.path}</span>
                            </div>
                        `);
                    } else {
                        results.push(`
                            <div class="status-item status-error">
                                <span>âŒ ${file.name} (${response.status})</span>
                                <span>${file.path}</span>
                            </div>
                        `);
                    }
                } catch (error) {
                    results.push(`
                        <div class="status-item status-error">
                            <span>âŒ ${file.name} (ç½‘ç»œé”™è¯¯)</span>
                            <span>${file.path}</span>
                        </div>
                    `);
                }
            }
            
            statusDiv.innerHTML = results.join('');
        }

        // æ£€æŸ¥åŠŸèƒ½çŠ¶æ€
        async function checkFeatures() {
            const statusDiv = document.getElementById('featureStatus');
            statusDiv.innerHTML = '<div class="status-item status-loading"><span>ğŸ”„ æµ‹è¯•åŠŸèƒ½ä¸­...</span></div>';

            const results = [];

            // æµ‹è¯•URLç”Ÿæˆå™¨æ¨¡å—
            try {
                const module = await import('./js/modules/url-generator.js');
                if (module.URLGenerator) {
                    results.push(`
                        <div class="status-item status-success">
                            <span>âœ… URLç”Ÿæˆå™¨æ¨¡å—</span>
                            <span>å¯æ­£å¸¸å¯¼å…¥</span>
                        </div>
                    `);
                } else {
                    results.push(`
                        <div class="status-item status-error">
                            <span>âŒ URLç”Ÿæˆå™¨æ¨¡å—</span>
                            <span>å¯¼å‡ºä¸æ­£ç¡®</span>
                        </div>
                    `);
                }
            } catch (error) {
                results.push(`
                    <div class="status-item status-error">
                        <span>âŒ URLç”Ÿæˆå™¨æ¨¡å—</span>
                        <span>${error.message}</span>
                    </div>
                `);
            }

            // æµ‹è¯•ä¸»åº”ç”¨æ¨¡å—
            try {
                const module = await import('./js/main.js');
                results.push(`
                    <div class="status-item status-success">
                        <span>âœ… ä¸»åº”ç”¨æ¨¡å—</span>
                        <span>å¯æ­£å¸¸å¯¼å…¥</span>
                    </div>
                `);
            } catch (error) {
                results.push(`
                    <div class="status-item status-error">
                        <span>âŒ ä¸»åº”ç”¨æ¨¡å—</span>
                        <span>${error.message}</span>
                    </div>
                `);
            }

            statusDiv.innerHTML = results.join('');
        }

        // æµ‹è¯•URLç”Ÿæˆå™¨åŠŸèƒ½
        async function testUrlGenerator() {
            const testDiv = document.getElementById('urlGeneratorTest');
            testDiv.innerHTML = '<div class="status-item status-loading"><span>ğŸ”„ æµ‹è¯•ä¸­...</span></div>';

            try {
                const module = await import('./js/modules/url-generator.js');
                const generator = new module.URLGenerator();
                
                // æµ‹è¯•é…ç½®
                const testConfig = {
                    port: 7890,
                    'socks-port': 7891,
                    mode: 'rule',
                    'log-level': 'info',
                    'proxy-groups': [
                        {
                            name: 'Proxy',
                            type: 'select',
                            proxies: ['DIRECT']
                        }
                    ],
                    rules: ['MATCH,Proxy']
                };

                const result = generator.generateConfigURL(testConfig);
                
                if (result.success && result.subscriptionUrl) {
                    testDiv.innerHTML = `
                        <div class="status-item status-success">
                            <span>âœ… URLç”ŸæˆåŠŸèƒ½æ­£å¸¸</span>
                            <span>ç”Ÿæˆäº† ${Object.keys(result.clientLinks).length} ä¸ªå®¢æˆ·ç«¯é“¾æ¥</span>
                        </div>
                    `;
                } else {
                    testDiv.innerHTML = `
                        <div class="status-item status-error">
                            <span>âŒ URLç”ŸæˆåŠŸèƒ½å¼‚å¸¸</span>
                            <span>æœªèƒ½ç”Ÿæˆæœ‰æ•ˆé“¾æ¥</span>
                        </div>
                    `;
                }
            } catch (error) {
                testDiv.innerHTML = `
                    <div class="status-item status-error">
                        <span>âŒ URLç”Ÿæˆå™¨æµ‹è¯•å¤±è´¥</span>
                        <span>${error.message}</span>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkDeploymentStatus();
                checkFiles();
                checkFeatures();
            }, 1000);
        });

        // æ¯30ç§’è‡ªåŠ¨é‡æ–°æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
        setInterval(checkDeploymentStatus, 30000);
    </script>
</body>
</html>
